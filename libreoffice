# ------------------------------------------------------------------
#
#    Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>

# config for abstractions/program-work-with-disk-** (**-rk,rwk)
@{PROG_DIR}="[^.]**"
@{PROG_FILE}="{[^.],.~}*.{odt,ott,oth,odm,ods,ots,sxw,stw,sxg,sxc,stc,odp,odg,otp,sxi,sti,odg,otg,sxd,std,doc,dot,xml,docx,docm,dotx,dotm,wpd,wps,rtf,txt,csv,sdw,sgl,vor,uot,html,htm,uof,jtd,jtt,hwp,602,pdb,psw,xls,xlw,xlt,xlsx,xlsm,xltx,xltm,xlsb,wk1,wks,123,dif,sdc,dbf,slk,uos,pxl,wb2,ppt,pps,pot,pptx,pptm,potx,potm,sda,sdd,sdp,uop,cgm,pdf,bmp,jpeg,jpg,pcx,psd,sgv,wmf,dxf,met,pgm,ras,svm,xbm,emf,pbm,plt,tga,xpm,eps,pcd,png,tif,tiff,gif,pct,ppm,sgf,ODT,OTT,OTH,ODM,ODS,OTS,SXW,STW,SXG,SXC,STC,ODP,ODG,OTP,SXI,STI,ODG,OTG,SXD,STD,DOC,DOT,XML,DOCX,DOCM,DOTX,DOTM,WPD,WPS,RTF,TXT,CSV,SDW,SGL,VOR,UOT,HTML,HTM,UOF,JTD,JTT,HWD,PDB,PSW,XLS,XLW,XLT,XLSX,XLSM,XLTX,XLTM,XLSB,WK1,WKS,DIF,SDC,DBF,SLK,UOS,PXL,WB2,PPT,PPS,POT,PPTX,PPTM,POTX,POTM,SDA,SDD,SDP,UOP,CGM,PDF,BMP,JPEG,JPG,PCX,PSD,SGC,WMF,DXF,MET,PGM,RAS,SVM,XBM,EMF,PBM,PLT,TGA,XPM,EPS,PCD,PNG,TIF,TIFF,GIF,PCT,PPM,SGF}{,#}"

profile libreoffice /usr/{bin,lib64/libreoffice/program}/soffice {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  /dev/tty rw,
  /dev/tty[0-9]* w,
  
  /bin/bash mr,
  /bin/dirname ix,
  /bin/basename ix,
  /bin/grep ix,
  /bin/uname ix,
  /bin/ls ix,
  /bin/sed ix,
  /usr/lib{,32,64}/libreoffice/program/oosplash Px,
  
}


profile libreoffice.oosplash /usr/lib{,32,64}/libreoffice/program/oosplash {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  /dev/tty[0-9]* w,
  /sys/devices/virtual/block/dm-[0-9]*/queue/rotational r,
  
  /usr/lib{,32,64}/libreoffice/program/oosplash m,
  /usr/lib{,32,64}/libreoffice/program/javaldx Px,
  /usr/lib{,32,64}/libreoffice/program/soffice.bin Px,
  
  owner @{HOME}/.Xauthority r,
  
}


profile libreoffice.javaldx /usr/lib{,32,64}/libreoffice/program/javaldx {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  /dev/tty[0-9]* w,
  
  /usr/lib{,32,64}/libreoffice/program/javaldx m,
  /opt/{oracle-jdk,icedtea}-bin-*/bin/java Px,
  /opt/{oracle-jdk,icedtea}-bin-*/jre/bin/java Px,
  
  owner @{HOME}/.config/libreoffice/ rw,
  owner @{HOME}/.config/libreoffice/** rwk,
  
}


profile libreoffice.bin /usr/lib{,32,64}/libreoffice/program/soffice.bin {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/dconf>
  #include <abstractions/enchant>
  #include <abstractions/gtk>	# Note, LO use its own vcl that can hook up into
  #include <abstractions/qt>	# GTK and QT to draw native controls (widgets).
  #include <abstractions/nvidia>
  #include <abstractions/X>
  #include <abstractions/ssl_keys>
  #include <abstractions/cups-client>
  #include <abstractions/xdg-open>
  #include <abstractions/program-work-with-disk-rwk>
  #include <abstractions/nameservice>
  
  /dev/tty[0-9]* w,
  /dev/pts/[0-9]* rw,
  /sys/devices/system/cpu/ r,
  @{PROC}/version r,
  @{PROC}/sys/vm/mmap_min_addr r,
  
  /usr/lib{,32,64}/libreoffice/program/soffice.bin m,
  /bin/bash Cx -> shell,
  /opt/{oracle-jdk,icedtea}-bin-*/bin/java Px,
  /opt/{oracle-jdk,icedtea}-bin-*/jre/bin/java Px,
  
  /etc/OpenCL/vendors/{,*} r,
  /usr/lib{,32,64}/libreoffice/{,**} r,
  /usr/share/liblangtag/** r,
  /usr/share/libexttextcat/{,*} r,
  
  owner @{HOME}/.config/libreoffice/ rw,
  owner @{HOME}/.config/libreoffice/** rwk,
  owner @{HOME}/.languagetool-ooo.cfg rw,
  
  # jre
  /opt/{oracle-jdk,icedtea}-bin-*/{,**} r,
  /opt/{oracle-jdk,icedtea}-bin-*/jre/lib/**.so rm,
  /usr/ r,
  /usr/lib{,32,64}/ r,
  /usr/lib{,32,64}/jvm/{,**} r,
  
  /tmp/ r,
  owner /tmp/?????? rwk,
  owner /tmp/*.tmp/ rw,
  owner /tmp/*.tmp/*.tmp rwk,
  owner /tmp/.gl* rw,
  owner /tmp/OSL_PIPE_[0-9]*_SingleOfficeIPC_* rw,
  
  # Noisy
  deny /usr/lib{,32,64}/libreoffice/share/uno_packages/cache/* w,
  
  
  profile shell {
    #include <abstractions/base>
    #include <abstractions/xdg-open>
    
    /dev/tty rw,
    
    /bin/bash mr,
    /bin/sed ix,
    /bin/grep ix,
    /usr/bin/paperconf ix,
    /usr/lib{,32,64}/libreoffice/program/open-url ix,
    
  }
  
}
