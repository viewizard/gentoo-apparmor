# ------------------------------------------------------------------
#
#  Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of version 2 of the GNU General Public
#  License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>

profile openrc /sbin/openrc flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability sys_ptrace,
  capability sys_tty_config,
  capability dac_override,
  capability kill,
  
  # PTRACE ---------------------------------------------
  ptrace (trace) peer="sysvinit.init",
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/tty[0-9]*					rw,
  /dev/console						rw,
  /dev/ptmx						rw,
  /dev/pts/[0-9]*					rw,
  /sys/fs/cgroup/					r,
  /sys/fs/cgroup/**					rwk,
  @{PROC}/						r,
  @{PROC}/cmdline					r,
  @{PROC}/@{pid}/cmdline				r,
  @{PROC}/@{pid}/environ				r,
  @{PROC}/@{pid}/stat					r,
  @{PROC}/@{pid}/mounts					r,
  owner @{PROC}/@{pid}/cmdline				r,
  
  # EXECUTABLES ----------------------------------------
  /sbin/openrc						mr,
  @{shell}						Cx,
  /lib{,32,64}/rc/sh/init-early.sh			Px,
  /lib{,32,64}/rc/sh/init.sh				Px,
  # All scripts from ALL runlevels must have profiles!
  /etc/init.d/*						Px,
  
  # READS/WRITES ---------------------------------------
  /etc/conf.d/*						r,
  /etc/rc.conf						r,
  /etc/profile.env					r,
  /etc/fstab						r,
  /etc/{conf,init}.d/					r,
  /etc/runlevels/{,**}					rw,
  /var/log/rc.log					w,
  /run/**{,.}pid					rw,
  /run/openrc/**					rwk,
  
  profile shell @{shell} flags=(complain) {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
    
    # CAPABILITIES -------------------------------------
    capability sys_tty_config,
    capability dac_override,
    capability dac_read_search,
    
    # PSEUDO -------------------------------------------
    /dev/pts/[0-9]*					rw,
    /dev/console					rw,
  }
}

profile openrc.rc-service /sbin/rc-service flags=(complain) {
  #include <abstractions/base>
  
  # EXECUTABLES ----------------------------------------
  /sbin/rc-service					mr,
  /etc/init.d/*						Px,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/scheduled/				rw,
}

profile openrc.rc-update /sbin/rc-update flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # PSEUDO ---------------------------------------------
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /sbin/rc-update					mr,
  
  # READS/WRITES ---------------------------------------
  /etc/init.d/						r,
  /etc/runlevels/{,**}					rw,
  /run/openrc/**					rw,
}

profile openrc.rc-status /bin/rc-status {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability kill,
  capability sys_ptrace,
  capability dac_read_search,
  capability dac_override,
  
  # PSEUDO ---------------------------------------------
  /dev/pts/[0-9]*					rw,
  @{PROC}/						r,
  @{PROC}/cmdline					r,
  @{PROC}/@{pid}/{cmdline,environ}			r,
  
  # EXECUTABLES ----------------------------------------
  /bin/rc-status					mr,
  @{shell}						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/					r,
  /etc/rc.conf						r,
  /etc/runlevels/{,**}					r,
  /run/openrc/**					r,
  /run/openrc/depconfig					w,
  /run/openrc/deptree					w,
  /run/{*.,*/,*/*.}pid					r,
  
  profile shell @{shell} flags=(complain) {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
}

profile openrc.gendepends.sh /lib{,32,64}/rc/sh/gendepends.sh flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  capability dac_override,
  capability dac_read_search,
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/pts/[0-9]*					rw,
  /dev/console						rw,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						mr,
  /bin/sed						Cx,
  /bin/grep						Cx,
  /sbin/openrc						Px,
  /sbin/lvm						Px,
  /usr/bin/gawk						Cx,
  /lib{,32,64}/rc/sh/gendepends.sh			r,
  /lib{,32,64}/rc/bin/shell_var				Px,
  /lib{,32,64}/rc/bin/service_started			Px,
  /lib{,32,64}/rc/bin/service_get_value			Px,
  /lib{,32,64}/rc/bin/fstabinfo				Px,
  /lib{,32,64}/rc/bin/eval_ecolors			Px,
  
  # READS/WRITES ---------------------------------------
  /etc/rc.conf						r,
  /etc/zfs/zfs-functions				r,
  /etc/exports.d/{,*}					r,
  /etc/{conf,init}.d/{,*}				r,
  /usr/libexec/rc.apparmor.functions			r,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  
  profile sed /bin/sed flags=(complain) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/sed						mr,
  }
  
  profile grep /bin/grep flags=(attach_disconnected,complain) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/grep						mr,
    
    # READS/WRITES -------------------------------------
    /etc/fstab						r,
    /etc/{conf,init}.d/{,*}				r,
    
    # DENY INHERIT -------------------------------------
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
  }
  
  profile gawk /usr/bin/gawk flags=(complain) {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability mknod,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /usr/bin/gawk					mr,
    
    # READS/WRITES -------------------------------------
    /etc/exports					r,
    /etc/ssh/sshd_config				r,
  }
}

profile openrc.init-early.sh /lib{,32,64}/rc/sh/init-early.sh flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/pts/[0-9]*					rw,
  /dev/null						w,
  /dev/console						rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/sh/init-early.sh			r,
  @{shell}						mr,
  /usr/bin/setfont					Px,
  /usr/bin/loadkeys					Px,
  /usr/bin/kbd_mode					Px,
}

profile openrc.init.sh /lib{,32,64}/rc/sh/init.sh flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/sh/init.sh				r,
  @{shell}						mr,
  /bin/grep						Cx,
  /bin/cp						Cx,
  /sbin/openrc						Px,
  /usr/bin/md5sum					Cx,
  /lib{,32,64}/rc/bin/checkpath				Px,
  /lib{,32,64}/rc/bin/eval_ecolors			Px,
  /lib{,32,64}/rc/bin/einfo				Px,
  /lib{,32,64}/rc/bin/mountinfo				Px,
  
  # READS/WRITES ---------------------------------------
  /etc/rc.conf						r,
  /run/openrc/softlevel					w,
  
  profile grep /bin/grep flags=(complain) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/grep						mr,
  }
  
  profile cp /bin/cp flags=(complain) {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/cp						mr,
    
    # READS/WRITES -------------------------------------
    /run/openrc/{,*}					w,
  }
  
  profile md5sum /usr/bin/md5sum flags=(complain) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/@{pid}/environ				r,
    
    # EXECUTABLES --------------------------------------
    /usr/bin/md5sum					mr,
  }
}

profile openrc.cgroup-release-agent.sh /lib{,32,64}/rc/sh/cgroup-release-agent.sh {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/sh/cgroup-release-agent.sh		r,
  @{shell}						mr,
  /bin/rmdir						Cx,
  
  profile rmdir /bin/rmdir {
    #include <abstractions/base>
    
    # CAPABILITIES ---------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /sys/fs/cgroup/openrc/**				w,
    
    # EXECUTABLES --------------------------------------
    /bin/rmdir						mr,
  }
}

profile openrc.checkpath /lib{,32,64}/rc/bin/checkpath flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  #include <abstractions/nameservice>
  
  # CAPABILITIES ---------------------------------------
  capability chown,
  capability fsetid,
  capability dac_override,
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/checkpath				mr,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/						w,	# DELEGATION! openrc.init.sh
  /run/lock/						w,	# DELEGATION! openrc.init.sh
}

profile openrc.mountinfo /lib{,32,64}/rc/bin/mountinfo flags=(complain) {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability dac_override,
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  @{PROC}/@{pid}/mounts					r,
  @{PROC}/cgroups					r,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/mountinfo				mr,
  
  # READS/WRITES ---------------------------------------
  /etc/fstab						r,
}

profile openrc.fstabinfo /lib{,32,64}/rc/bin/fstabinfo flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/fstabinfo				mr,
  
  # READS/WRITES ---------------------------------------
  /etc/fstab						r,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.eval_ecolors /lib{,32,64}/rc/bin/eval_ecolors flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/eval_ecolors			mr,
}

profile openrc.ebegin /lib{,32,64}/rc/bin/ebegin flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/ebegin				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  deny /etc/conf.d/dmcrypt				r,
}

profile openrc.eend /lib{,32,64}/rc/bin/eend flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/eend				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  deny /etc/conf.d/dmcrypt				r,
}

profile openrc.ewend /lib{,32,64}/rc/bin/ewend flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/ewend				mr,
}

profile openrc.shell_var /lib{,32,64}/rc/bin/shell_var flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/shell_var				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.einfo /lib{,32,64}/rc/bin/einfo flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/einfo				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  deny /etc/conf.d/dmcrypt				r,
}

profile openrc.ewarn /lib{,32,64}/rc/bin/ewarn flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/ewarn				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.eerror /lib{,32,64}/rc/bin/eerror flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  #include <abstractions/ncurses>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/eerror				mr,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.service /lib{,32,64}/rc/bin/service_* flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  @{PROC}/						r,
  @{PROC}/@{pid}/cmdline				r,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/service_*				mr,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/scheduled/				r,
  /run/openrc/daemons/{,**}				r,
  /run/**.pid						r,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.service_set_value /lib{,32,64}/rc/bin/service_set_value flags=(complain) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/service_set_value			mr,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/options/**				w,
}

profile openrc.service_get_value /lib{,32,64}/rc/bin/service_get_value flags=(attach_disconnected,complain) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/bin/service_get_value			mr,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/options/**				r,
  
  # DENY INHERIT ---------------------------------------
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
}

profile openrc.mark_service_inactive /lib{,32,64}/rc/sbin/mark_service_inactive flags=(complain) {
  #include <abstractions/base>
  
  # SIGNAL ---------------------------------------------
  signal (send) set=(hup) peer="*.init.d",
  
  # PSEUDO ---------------------------------------------
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /lib{,32,64}/rc/sbin/mark_service_inactive		mr,
  
  # READS/WRITES ---------------------------------------
  /run/openrc/inactive/*				w,
  /run/openrc/starting/*				w,
  /run/openrc/exclusive/*				w,
  /run/openrc/stopping/*				w,
}

profile openrc.netmount.init.d /etc/init.d/netmount {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/netmount/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /etc/init.d/dnsmasq					Px,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  /bin/umount						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/netmount				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/netmount/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # MOUNT --------------------------------------------	# FIX ME! /etc/fstab - сетевые фс.
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
    
    # READS/WRITES -------------------------------------
    /etc/fstab						r,
  }
  
  profile umount /bin/umount {
    #include <abstractions/base>
    
    # MOUNT --------------------------------------------	# FIX ME! /etc/fstab - сетевые фс.
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/@{pid}/mountinfo				r,
    
    # EXECUTABLES --------------------------------------
    /bin/umount						mr,
  }
}

profile openrc.consolefont.init.d /etc/init.d/consolefont {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					r,
  /sys/fs/cgroup/openrc/consolefont/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  /bin/mkdir						Cx,
  /usr/bin/setfont					Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/consolefont			r,
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES ---------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/consolefont/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
    
    # READS/WRITES -------------------------------------
    /lib{,32,64}/rc/console/				w,
  }
}

profile openrc.local.init.d /etc/init.d/local {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  #include <local/openrc-local-scripts>				# Работа со скриптами в /etc/local.d
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/local/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/local				r,
  /etc/local.d/{,*}					r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/local/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.hwclock.init.d /etc/init.d/hwclock {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /dev/							r,
  /sys/fs/cgroup/openrc/hwclock/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/uname						Px,
  /bin/grep						Cx,
  /bin/mkdir						Cx,
  /sbin/hwclock						Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/hwclock				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile grep /bin/grep {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/devices					r,
    
    # EXECUTABLES --------------------------------------
    /bin/grep						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/hwclock/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.swap.init.d /etc/init.d/swap {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/swap/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  /sbin/swapon						Px,
  /sbin/swapoff						Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/swap				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/swap/				w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.modules.init.d /etc/init.d/modules {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/modules/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/uname						Px,
  /bin/kmod						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/modules				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/modules/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.fsck.init.d /etc/init.d/fsck {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/fsck/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /etc/init.d/*						Px,
  /bin/cat						Cx,
  /bin/mkdir						Cx,
  /sbin/fsck						Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/fsck				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile cat /bin/cat {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/cmdline					r,
    
    # EXECUTABLES --------------------------------------
    /bin/cat						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/fsck/				w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.opentmpfiles-dev.init.d /etc/init.d/opentmpfiles-dev {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/opentmpfiles-dev/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/tmpfiles						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/opentmpfiles-dev			r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/opentmpfiles-dev/		w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.opentmpfiles-setup.init.d /etc/init.d/opentmpfiles-setup {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/opentmpfiles-setup/tasks	w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/tmpfiles						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/opentmpfiles-setup			r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/opentmpfiles-setup/		w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.root.init.d /etc/init.d/root {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/root/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  /etc/init.d/mtab					Px,
  /bin/rm						Cx,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  @{shell}						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/root				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile rm /bin/rm {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/rm						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/root/				w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    
    # MOUNT --------------------------------------------	# Допустимые опции перемонтирования корневого раздела.
    mount options=(rw, remount, relatime) -> /,
    mount options=(rw, remount, noatime) -> /,
    mount options=(rw, remount, relatime, iversion) -> /,
    mount options=(rw, remount, noatime, iversion) -> /,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/devices/virtual/block/@{BLOCK_VIRT}/{,**}	r,
    @{PROC}/@{pid}/mount{s,info}			r,
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
    
    # READS/WRITES -------------------------------------
    /							r,
    /etc/fstab						r,
  }
}

profile openrc.mtab.init.d /etc/init.d/mtab {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/mtab/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  /bin/ln						Cx,
  /bin/mkdir						Cx,
  @{shell}						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/mtab				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile ln /bin/ln {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/ln						mr,
    
    # READS/WRITES -------------------------------------
    /etc/mtab						w,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/mtab/				w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.localmount.init.d /etc/init.d/localmount {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/localmount/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /etc/init.d/*						Px,
  /bin/sed						Cx,
  /bin/sync						Px,
  /bin/fuser						Px,
  /bin/sleep						Px,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  /bin/umount						Cx,
  /usr/bin/timeout					Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/localmount				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile sed /bin/sed {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/sed						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/localmount/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    capability dac_override,
    
    # MOUNT --------------------------------------------	# FIX ME! /etc/fstab - локальные фс.
    mount fstype=ext4 options=(rw, nosuid, nodev, noexec, noatime, iversion) /dev/@{BLOCK_ALL} -> /var/,
    mount fstype=ext4 options=(rw, nosuid, nodev, noexec, noatime, iversion) /dev/@{BLOCK_ALL} -> /var/log/,
    mount fstype=ext4 options=(rw, nosuid, nodev, noatime, iversion) /dev/@{BLOCK_ALL} -> /var/tmp/portage/,	# BUILD SYSTEM ONLY!
    mount fstype=ext4 options=(rw, noatime) /dev/@{BLOCK_ALL} -> /home/,
    mount fstype=ext4 options=(rw, nosuid, nodev, noexec, noatime, iversion) /dev/@{BLOCK_ALL} -> /usr/portage/,
    mount fstype=ext4 options=(rw, nosuid, nodev, noatime) /dev/@{BLOCK_ALL} -> /usr/src/,			# BUILD SYSTEM ONLY!
    mount fstype=ext4 options=(rw, nosuid, nodev, noexec, noatime, iversion) /dev/@{BLOCK_ALL} -> /mnt/backup/,
    mount fstype=ext4 options=(rw, nosuid, nodev, noexec, noatime, iversion) /dev/@{BLOCK_ALL} -> /media/sdb2/,
    mount fstype=tmpfs options=(rw, nosuid, nodev, noexec, noatime, nodiratime) tmpfs -> /tmp/,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/devices/virtual/block/@{BLOCK_VIRT}/{,**}	r,
    /sys/devices/pci[0-9]*/**/{ata,usb}[0-9]*/**/block/@{BLOCK_REAL}/{,**} r,
    @{PROC}/@{pid}/mountinfo				r,
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
    
    # READS/WRITES -------------------------------------
    /etc/fstab						r,
    /run/mount/						w,
    /run/mount/utab					rw,
    /run/mount/utab.*					rwk,
  }
  
  profile umount /bin/umount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    capability dac_override,
    
    # MOUNT --------------------------------------------
    umount,							# FIX ME! Сделать deny на то, что нельзя отмонтировать.
    								# См. /etc/init.d/localmount.
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/@{pid}/mountinfo				r,
    
    # EXECUTABLES --------------------------------------
    /bin/umount						mr,
    
    # READS/WRITES -------------------------------------
    /run/mount/utab					rw,
  }
  
  profile timeout /usr/bin/timeout {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /usr/bin/timeout					mr,
    /bin/fuser						Px,
  }
}

profile openrc.sysctl.init.d /etc/init.d/sysctl {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/sysctl/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  /usr/sbin/sysctl					Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/sysctl				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/sysctl/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.bootmisc.init.d /etc/init.d/bootmisc {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/bootmisc/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/rm						Cx,
  /bin/readlink						Cx,
  /bin/mktemp						Cx,
  /bin/rmdir						Cx,
  /bin/chgrp						Cx,
  /bin/chmod						Cx,
  /bin/dmesg						Px,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  /bin/umount						Cx,
  /sbin/halt						Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/bootmisc				r,
  /run/utmp						w,
  /var/log/dmesg					w,
  /var/log/wtmp						w,
  
  # TEMP -----------------------------------------------
  owner /tmp/tmp.*/run/					r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile rm /bin/rm {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/rm						mr,
    
    # READS/WRITES -------------------------------------
    /lib{,32,64}/rc/console/{font,keymap,unicode}	w,
  }
  
  profile readlink /bin/readlink {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/readlink					mr,
  }
  
  profile mktemp /bin/mktemp {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/mktemp						mr,
    
    # TEMP ---------------------------------------------
    owner /tmp/tmp.*/					w,
  }
  
  profile rmdir /bin/rmdir {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/rmdir						mr,
    
    # TEMP ---------------------------------------------
    owner /tmp/tmp.*/					w,
  }
  
  profile chgrp /bin/chgrp {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    
    # CAPABILITIES -------------------------------------
    capability chown,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/chgrp						mr,
    
    # READS/WRITES -------------------------------------
    /run/utmp						w,
  }
  
  profile chmod /bin/chmod {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability fsetid,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/chmod						mr,
    
    # READS/WRITES -------------------------------------
    /run/utmp						w,
    /var/log/dmesg					w,
    
    # TEMP ---------------------------------------------
    owner /tmp/.ICE-unix/				w,
    owner /tmp/.X11-unix/				w,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/bootmisc/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
    
    # TEMP ---------------------------------------------
    owner /tmp/.ICE-unix/				w,
    owner /tmp/.X11-unix/				w,
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    
    # MOUNT --------------------------------------------
    mount options=(rw, bind) / -> /tmp/tmp.*/,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
    
    # READS/WRITES -------------------------------------
    /run/mount/utab					rw,
  }
  
  profile umount /bin/umount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    
    # MOUNT --------------------------------------------
    umount /tmp/tmp.*/,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/umount						mr,
    
    # READS/WRITES -------------------------------------
    /run/mount/utab					rw,
  }
}

profile openrc.hostname.init.d /etc/init.d/hostname {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # CAPABILITIES ---------------------------------------
  capability sys_admin,
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/hostname/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /etc/init.d/syslog-ng					Px,
  /bin/hostname						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/hostname				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/hostname/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.termencoding.init.d /etc/init.d/termencoding {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /sys/fs/cgroup/openrc/termencoding/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  /etc/init.d/keymaps					Px,
  /etc/init.d/consolefont				Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/termencoding			r,
  /lib{,32,64}/rc/console/unicode			w,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES ---------------------------------------
    capability dac_override,
  
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/termencoding/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
    
    # READS/WRITES -------------------------------------
    /lib{,32,64}/rc/console/				w,
  }
}

profile openrc.runsvdir.init.d /etc/init.d/runsvdir {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/runsvdir/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/runsvdir				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/runsvdir/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.keymaps.init.d /etc/init.d/keymaps {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					r,
  /sys/fs/cgroup/openrc/keymaps/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  /bin/mkdir						Cx,
  /usr/bin/kbd_mode					Px,
  /usr/bin/loadkeys					Px,
  /usr/bin/dumpkeys					Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/keymaps				r,
  /lib{,32,64}/rc/console/keymap			w,
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/keymaps/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
    
    # READS/WRITES -------------------------------------
    /lib{,32,64}/rc/console/				w,
  }
}

profile openrc.urandom.init.d /etc/init.d/urandom {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /dev/urandom						w,
  /sys/fs/cgroup/openrc/urandom/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/cat						Cx,
  /bin/dd						Cx,
  /bin/rm						Cx,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/urandom				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile cat /bin/cat {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability mknod,
    
    # PSEUDO -------------------------------------------
    /dev/urandom					w,
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/sys/kernel/random/poolsize			r,
    
    # EXECUTABLES --------------------------------------
    /bin/cat						mr,
    
    # READS/WRITES -------------------------------------
    /var/lib/misc/random-seed				r,
  }
  
  profile dd /bin/dd {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/dd						mr,
    
    # READS/WRITES -------------------------------------
    /var/lib/misc/random-seed				w,
  }
  
  profile rm /bin/rm {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/rm						mr,
    
    # READS/WRITES -------------------------------------
    /var/lib/misc/random-seed				w,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/urandom/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.loopback.init.d /etc/init.d/loopback {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/loopback/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/ip						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/loopback				r,
  /etc/iproute2/rt_scopes				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/loopback/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.procfs.init.d /etc/init.d/procfs {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/procfs/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/procfs				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/procfs/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.killprocs.init.d /etc/init.d/killprocs {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # SIGNAL ---------------------------------------------
  signal (receive),						# FIX ME! Не удалось понять что именно получает. Выполняется
  								# в конце выключения/перезагрузки, даже в тестовом режиме
  								# запуска syslog-ng к этому моменту убивает процесс syslog-ng.
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/killprocs/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  /sbin/killall5					Px,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/killprocs				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/killprocs/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.mount-ro.init.d /etc/init.d/mount-ro {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/mount-ro/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/sync						Px,
  /bin/sed						Cx,
  /bin/fuser						Px,
  /bin/mkdir						Cx,
  /bin/umount						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/mount-ro				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile sed /bin/sed {
    #include <abstractions/base>
    
    # EXECUTABLES --------------------------------------
    /bin/sed						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/mount-ro/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile umount /bin/umount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    capability dac_override,
    
    # MOUNT --------------------------------------------
    umount,							# Должен отмонтировать все, что осталось.
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/@{pid}/mountinfo				r,
    
    # EXECUTABLES --------------------------------------
    /bin/umount						mr,
    
    # READS/WRITES -------------------------------------
    /run/mount/utab					rw,
  }
}

profile openrc.savecache.init.d /etc/init.d/savecache {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/savecache/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/cp						Cx,
  /bin/mkdir						Cx,
  /bin/rm						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/savecache				r,
  /lib{,32,64}/rc/cache/*				rw,
  /run/openrc/**					r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/savecache/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile cp /bin/cp {
    #include <abstractions/base>
    
    # EXECUTABLES --------------------------------------
    /bin/cp						mr,
    
    # READS/WRITES -------------------------------------
    /run/openrc/**					r,
    /lib{,32,64}/rc/cache/**				w,
  }
  
  profile rm /bin/rm {
    #include <abstractions/base>
    
    # EXECUTABLES --------------------------------------
    /bin/rm						mr,
    
    # READS/WRITES -------------------------------------
    /lib{,32,64}/rc/cache/{,**}				w,
  }
}

profile openrc.devfs.init.d /etc/init.d/devfs {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # CAPABILITIES ---------------------------------------
  capability mknod,
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/devfs/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/grep						Cx,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/devfs				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile grep /bin/grep {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/filesystems					r,
    
    # EXECUTABLES --------------------------------------
    /bin/grep						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/mqueue/					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    
    # MOUNT --------------------------------------------
    mount options=(rw, nosuid, remount) -> /dev/,
    mount fstype=mqueue options=(rw, nosuid, nodev, noexec) mqueue -> /dev/mqueue/,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
  }
}

profile openrc.dmesg.init.d /etc/init.d/dmesg {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/dmesg/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/dmesg						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/dmesg				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/dmesg/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.kmod-static-nodes.init.d /etc/init.d/kmod-static-nodes {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/kmod-static-nodes/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/kmod						Px,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/kmod-static-nodes			r,
  /run/tmpfiles.d/					w,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/kmod-static-nodes/		w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.sysfs.init.d /etc/init.d/sysfs {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/*/{,**}				w,
  @{PROC}/cgroups					r,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/grep						Cx,
  /bin/mkdir						Cx,
  /bin/mount						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/sysfs				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile grep /bin/grep {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/filesystems					r,
    
    # EXECUTABLES --------------------------------------
    /bin/grep						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/						w,
    /sys/fs/cgroup/*/					w,
    /sys/fs/cgroup/openrc/sysfs/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
    
    # DENY INHERIT -------------------------------------
    deny /proc/cgroups					r,	# openrc.sysfs.init.d
  }
  
  profile mount /bin/mount {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability sys_admin,
    capability dac_override,
    
    # MOUNT --------------------------------------------
    mount fstype=securityfs options=(rw, nosuid, nodev, noexec) securityfs -> /sys/kernel/security/,
    mount fstype=configfs options=(rw, nosuid, nodev, noexec) configfs -> /sys/kernel/config/,
    mount fstype=fusectl options=(rw, nosuid, nodev, noexec) fusectl -> /sys/fs/fuse/connections/,
    mount fstype=tmpfs options=(rw, nosuid, nodev, noexec) cgroup_root -> /sys/fs/cgroup/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) openrc -> /sys/fs/cgroup/openrc/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) cpuset -> /sys/fs/cgroup/cpuset/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) cpu -> /sys/fs/cgroup/cpu/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) cpuacct -> /sys/fs/cgroup/cpuacct/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) freezer -> /sys/fs/cgroup/freezer/,
    mount fstype=cgroup options=(rw, nosuid, nodev, noexec) net_cls -> /sys/fs/cgroup/net_cls/,
  
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    @{PROC}/cgroups					r,
    
    # EXECUTABLES --------------------------------------
    /bin/mount						mr,
  }
}

profile openrc.modules-load.init.d /etc/init.d/modules-load {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/modules-load/tasks		w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/kmod						Px,
  /bin/sort						Cx,
  /bin/mkdir						Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/{conf,init}.d/modules-load			r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile sort /bin/sort {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/sort						mr,
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/modules-load/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
}

profile openrc.agetty.init.d /etc/init.d/agetty flags=(complain) {	# FIX ME! flags=(complain), проверить в работе!
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  # PSEUDO ---------------------------------------------
  /sys/fs/cgroup/openrc/agetty.*/tasks			w,
  
  # EXECUTABLES ----------------------------------------
  @{shell}						Cx,
  /bin/mkdir						Cx,
  /sbin/supervise-daemon				Cx,
  
  # READS/WRITES ---------------------------------------
  /etc/init.d/agetty					r,
  /etc/conf.d/agetty{,.*}				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
  }
  
  profile mkdir /bin/mkdir {
    #include <abstractions/base>
    
    # CAPABILITIES -------------------------------------
    capability dac_override,
    
    # PSEUDO -------------------------------------------
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    /sys/fs/cgroup/openrc/agetty.*/			w,
    
    # EXECUTABLES --------------------------------------
    /bin/mkdir						mr,
  }
  
  profile supervise-daemon /sbin/supervise-daemon flags=(complain) {	# FIX ME! flags=(complain), проверить в работе!
    #include <abstractions/base>
    #include <abstractions/nameservice>
    
    # SIGNAL -------------------------------------------
    signal (send) set=(term) peer="util-linux.agetty",
    
    # PSEUDO -------------------------------------------
    /dev/tty						rw,
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
  
    # EXECUTABLES --------------------------------------
    /sbin/supervise-daemon				mr,
    /sbin/agetty					Px,
  
    # READS/WRITES -------------------------------------
    /run/agetty.*.pid					rw,
    /run/openrc/daemons/agetty.*/{,**}			rw,
    /run/openrc/options/agetty.*/{,**}			rw,
    /run/openrc/scheduled/				r,
    /run/openrc/stopping/agetty.*			w,
    /run/openrc/exclusive/agetty.*			w,
  }
}
