# ------------------------------------------------------------------
#
#    Copyright (C) 2016 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>

# config for abstractions/program-work-with-disk-** (**-rk,rwk)
@{PROG_DIR}="[^.]**"
@{PROG_FILE}="[^.]*.png"  # xfce4-screenshooter

profile xfce4-panel /usr/bin/xfce4-panel {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/gtk>
  #include <abstractions/nvidia>
  #include <abstractions/X>
  #include <abstractions/nameservice>
  #include <abstractions/executable-binary-programs>
  #include <local/xfce4-panel-custom>
  
  /dev/tty[0-9]* w,
  @{PROC}/@{pid}/fd/ r,
  
  /usr/bin/xfce4-panel r,
  /usr/lib{,32,64}/xfce4/panel/wrapper-[1-2].0 Px,
  /usr/lib{,32,64}/xfce4/panel-plugins/xfce4-*-plugin Px,
  /usr/bin/exo-desktop-item-edit Px,
  
  /opt/**.png r,
  /etc/xdg/menus/**.menu r,
  /etc/xdg/menus/applications-merged/ r,
  /usr/share/xfce4/panel/plugins/{,*.desktop} r,
  /usr/share/xfce4/panel-plugins/{,*.desktop} r,
  /usr/share/desktop-directories/*.directory r,
  owner @{HOME}/.config/xfce4/panel/{,*.rc*} rw,
  owner @{HOME}/.config/xfce4/panel/launcher-**.desktop r,
  owner @{HOME}/.config/menus/**.menu rw,
  owner @{HOME}/.config/menus/applications-merged/ r,
  owner @{HOME}/.config/xfce4/panel/launcher-*/{,**} rw,
  owner @{HOME}/.local/share/desktop-directories/*.directory r,
  owner @{HOME}/.local/share/gvfs-metadata/{,*} r,
  
}


profile xfce4-panel.wrapper-1.0 /usr/lib{,32,64}/xfce4/panel/wrapper-1.0 {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/gtk>
  #include <abstractions/audio>
  #include <abstractions/nameservice>
  #include <abstractions/executable-binary-programs>
  #include <abstractions/program-work-with-disk-rwk>  # xfce4-screenshooter
  #include <abstractions/user-tmp>  # xfce4-screenshooter
  #include <local/xfce4-panel-custom>
  
  /dev/tty[0-9]* w,
  @{PROC}/@{pid}/fd/ r,
  
  /usr/bin/xfce4-session-logout Px,
  /bin/env Cx -> env,
  /usr/bin/xflock4 Px,
  /usr/bin/alock Px,
  /usr/bin/passwd.sh Px,
  /usr/bin/xfce4-panel Px,
  /usr/bin/xfce4-session-settings Px,
  
  /usr/share/alacarte/* r,
  /etc/xdg/menus/**.menu r,
  /etc/xdg/menus/applications-merged/ r,
  /usr/share/desktop-directories/{,*.directory} r,
  /opt/**.png r,
  
  /usr/share/xfce4/weather/icons/{,**.info,**.png} r,
  /usr/share/xfce4-notes-plugin/{,**} r,
  
  owner @{HOME}/.face r,
  owner @{HOME}/@{XDG_DESKTOP_DIR}/*.desktop rw,
  owner @{HOME}/.config/menus/**.menu rw,
  owner @{HOME}/.config/menus/applications-merged/ r,
  owner @{HOME}/.config/xfce4/panel/{,**} rw,
  owner @{HOME}/.config/xfce4/xfce4-notes.gtkrc* rw,
  owner @{HOME_CACHE}/xfce4/ rw,
  owner @{HOME_CACHE}/xfce4/clipman/{,*} rw,
  owner @{HOME_CACHE}/xfce4/weather/{,*} rw,
  owner @{HOME}/.local/share/applications/**.desktop rw,
  owner @{HOME}/.local/share/desktop-directories/{,*.directory} r,
  owner @{HOME}/.local/share/notes/{,**} rw,
  
  
  profile env {
    #include <abstractions/base>
    
    /dev/tty[0-9]* w,
    /dev/pts/[0-9]* rw,
    
    /bin/env r,
    /usr/bin/wine Px,
    
  }
  
}


profile xfce4-panel.wrapper-2.0 /usr/lib{,32,64}/xfce4/panel/wrapper-2.0 {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/gtk>
  #include <abstractions/audio>
  #include <abstractions/dbus-session>
  #include <abstractions/executable-binary-programs>
  
  /dev/tty[0-9]* w,
  @{PROC}/@{pid}/fd/ r,
  
  /usr/bin/pulseaudio Px,
  /usr/bin/pavucontrol Px,
  
}


profile xfce4-panel.xfce4-xkb-plugin /usr/lib{,32,64}/xfce4/panel-plugins/xfce4-xkb-plugin {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/gtk>
  
  /dev/tty[0-9]* w,
  @{PROC}/@{pid}/fd/ r,
  
  /usr/bin/xfce4-keyboard-settings Px,
  
  /usr/share/xfce4/xkb/flags/*.svg r,
  
  owner @{HOME}/.config/xfce4/panel/{,*.rc*} rw,
  
}


profile xfce4-panel.xfce4-kbdleds-plugin /usr/lib{,32,64}/xfce4/panel-plugins/xfce4-kbdleds-plugin {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/gtk>
  
  /dev/tty[0-9]* w,
  
  owner @{HOME}/.config/xfce4/panel/{,*.rc*} rw,
  
}


profile xfce4-panel.xfce4-sensors-plugin /usr/lib{,32,64}/xfce4/panel-plugins/xfce4-sensors-plugin {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/X>
  #include <abstractions/gtk>
  #include <abstractions/sensors>
  
  /dev/tty[0-9]* w,
  @{PROC}/@{pid}/fd/ r,
  
  /usr/bin/xfce4-sensors Px,
  
  owner @{HOME}/.config/xfce4/panel/{,*.rc*} rw,
  
}
