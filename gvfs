# ------------------------------------------------------------------
#
#    Copyright (C) 2016 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>
profile gvfs-udisks2-volume-monitor /usr/libexec/gvfs-udisks2-volume-monitor {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  capability dac_override,
  capability dac_read_search,
  
  /sys/devices/pci[0-9]*/**/block/sd[a-z]/sd[a-z][0-9]*/uevent r,
  /sys/devices/virtual/block/{dm-,md,zd,loop}[0-9]*/uevent r,
  /sys/devices/pci[0-9]*/**/usb[0-9]*/**/block/sr[0-9]*/uevent r,
  @{PROC}/@{pid}/fd/ r,
  @{PROC}/@{pid}/mounts r,
  
  /usr/libexec/gvfs-udisks2-volume-monitor mr,
  /bin/mount Px,
  
  /etc/fstab r,
  /etc/udev/udev.conf r,
  /usr/share/mime/treemagic r,
  /media/*/{,**/} r,
  /run/udev/data/* r,
  
  owner @{HOME}/.local/share/mime/treemagic r,
  
}


profile gvfsd /usr/libexec/gvfsd {
  #include <abstractions/base>
  
  owner @{PROC}/@{pid}/fd/ rw,
  
  /usr/libexec/gvfsd mr,
  /usr/libexec/gvfsd-* Px,
  
  /usr/share/gvfs/{,**} r,
  
  /run/user/*/gvfs/{,**} rw,
  
  owner @{HOME}/.gvfs/ rw,
  
}

profile gvfsd-archive /usr/libexec/gvfsd-archive flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-archive mr,
  
}

profile gvfsd-burn /usr/libexec/gvfsd-burn flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-burn mr,
  
}

profile gvfsd-computer /usr/libexec/gvfsd-computer flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-computer mr,
  
}

profile gvfsd-dav /usr/libexec/gvfsd-dav flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-dav mr,
  
}

profile gvfsd-ftp /usr/libexec/gvfsd-ftp flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-ftp mr,
  
}

profile gvfsd-fuse /usr/libexec/gvfsd-fuse {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  
  capability dac_override,
  capability dac_read_search,
  capability sys_admin,
  
  /dev/fuse rw,
  
  @{PROC}/@{pid}/mounts r,
  
  /usr/libexec/gvfsd-fuse mr,
  /usr/bin/fusermount ixr,
  
  /etc/fuse.conf r,
  
  /run/user/*/gvfs/{,**} rw,
  
  @{HOME}/.gvfs/{,**} rw,
  
}

profile gvfsd-http /usr/libexec/gvfsd-http flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/gtk>
  #include <abstractions/dconf>
  #include <abstractions/ssl_certs>
  
  /usr/libexec/gvfsd-http mr,
  
  /usr/lib{,32,64}/libproxy/[0-9]*.[0-9]*.[0-9]*/modules/*.so m,
  
}

profile gvfsd-localtest /usr/libexec/gvfsd-localtest flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-localtest mr,
  
}

profile gvfsd-metadata /usr/libexec/gvfsd-metadata {
  #include <abstractions/base>
  
  /etc/udev/udev.conf r,
  /sys/devices/pci[0-9]*/**/block/sd[a-z]/sd[a-z][0-9]*/uevent r,
  /sys/devices/virtual/block/{dm-,md,zd}[0-9]*/uevent r,
  /sys/devices/pci[0-9]*/**/usb[0-9]*/**/block/sd[a-z]/uevent r,
  /run/udev/data/* r,
    
  /usr/libexec/gvfsd-metadata mr,
  
  owner @{HOME}/.local/share/gvfs-metadata/{,**} rw,
  
}

profile gvfsd-network /usr/libexec/gvfsd-network flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/dconf>
  #include <abstractions/gtk>
  
  /usr/libexec/gvfsd-network mr,
  
}

profile gvfsd-recent /usr/libexec/gvfsd-recent flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-recent mr,
  
}

profile gvfsd-sftp /usr/libexec/gvfsd-sftp flags=(complain) {
  #include <abstractions/base>
  
  /usr/libexec/gvfsd-sftp mr,
  
}

profile gvfsd-smb /usr/libexec/gvfsd-smb {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/dconf>
  #include <abstractions/gtk>
  #include <abstractions/nameservice>
  
  /usr/libexec/gvfsd-smb mr,
  
  /etc/samba/smb.conf r,
  /usr/share/samba/codepages/** r,
  
  /var/cache/samba/ r,
  /var/cache/samba/** r,
  
}

profile gvfsd-smb-browse /usr/libexec/gvfsd-smb-browse {
  #include <abstractions/base>
  #include <abstractions/dconf>
  #include <abstractions/gtk>
  #include <abstractions/nameservice>
  
  /usr/libexec/gvfsd-smb-browse mr,
  
  /etc/samba/smb.conf r,
  /usr/share/samba/codepages/** r,

  /var/cache/samba/{,**} r,
  
}

profile gvfsd-trash /usr/libexec/gvfsd-trash {
  #include <abstractions/base>
  
  @{PROC}/@{pid}/mounts r,
  
  /usr/libexec/gvfsd-trash mr,
  
  # we must be able create and read all files
  # DAC will care about access permissions
  owner @{HOME}/** rw,
  /media/** rw,
  
  /usr/share/mime/mime.cache r,
  owner @{HOME}/.local/share/mime/mime.cache r,
  owner @{HOME}/.local/share/Trash/{,**} rw,
  
}

profile gvfs-open /usr/bin/gvfs-open flags=(complain) {
  #include <abstractions/base>
  
  /usr/bin/gvfs-open mr,
  
}
