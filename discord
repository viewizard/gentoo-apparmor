# ------------------------------------------------------------------
#
#    Copyright (C) 2017 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>
profile discord /opt/discord/share/discord/Discord {
  #include <abstractions/base>
  #include <abstractions/fonts>
  #include <abstractions/freedesktop.org>
  #include <abstractions/gtk>
  #include <abstractions/audio-pulseaudio-strict>
  #include <abstractions/nameservice>
  #include <abstractions/nvidia>
  #include <abstractions/X>
  
  capability sys_ptrace,
  
  /dev/ r,
  /dev/tty[0-9]* rw,
  /dev/pts/[0-9]* rw,
  /dev/shm/.org.chromium.Chromium.* rw,
  @{PROC}/ r,
  @{PROC}/@{pid}/stat r,
  @{PROC}/@{pid}/fd/ r,
  @{PROC}/@{pid}/oom_score_adj rw,
  @{PROC}/@{pid}/cmdline r,
  /sys/devices/system/cpu/ r,
  /sys/devices/system/cpu/cpufreq/policy[0-9]*/cpuinfo_max_freq r,
  /sys/devices/pci[0-9]**/{device,class,irq,resource,vendor} r,
  /sys/devices/virtual/tty/tty[0-9]**/active r,
  
  /opt/discord/share/discord/Discord Pxmr,
  /usr/bin/lsb_release Px,
  
  /opt/discord/** r,
  /opt/discord/**.so m,
  
  owner @{HOME}/.config/discord/{,**} rwk,
  owner @{HOME}/.config/discord/*/modules/**.{node,so} m,
  owner @{HOME}/.pki/nssdb/pkcs11.txt r,
  owner @{HOME}/.pki/nssdb/cert9.db rwk,
  owner @{HOME}/.pki/nssdb/key4.db rwk,
  owner @{HOME}/.config/autostart/discord-stable.desktop rw,
  
  /tmp/ r,
  owner /tmp/discord.sock rw,
  owner /tmp/.gl* rw,
  owner /tmp/.org.chromium.Chromium.* mrw,
  /var/tmp/ r,
  owner /var/tmp/etilqs_* rw,
  
}
