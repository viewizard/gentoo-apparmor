# ------------------------------------------------------------------
#
#  Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of version 2 of the GNU General Public
#  License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <abstractions/ncurses>

# CAPABILITIES -----------------------------------------
capability kill,
capability sys_ptrace,
capability dac_override,
capability sys_tty_config,

# PTRACE -----------------------------------------------
ptrace (trace),

# SIGNAL -----------------------------------------------
signal (send) set=(term, hup),

# PSEUDO -----------------------------------------------
/dev/tty						rw,
/dev/tty[0-9]*						rw,
/dev/console						rw,
/dev/pts/[0-9]*						rw,
@{sys}/fs/cgroup/					r,
@{sys}/fs/cgroup/*/tasks				w,
@{sys}/fs/cgroup/unified/cgroup.procs			w,
@{PROC}/						r,
@{PROC}/cmdline						r,
@{PROC}/@{pids}/environ					r,
@{PROC}/@{pids}/stat					r,
@{PROC}/@{pids}/cmdline					r,

# EXECUTABLES ------------------------------------------
/sbin/openrc-run					mr,
/sbin/start-stop-daemon					ix,	# checkpath, openrc-run.sh и start-stop-daemon
/lib{,32,64}/rc/sh/openrc-run.sh			ix,	# запускаем в профиле скрипта, чтобы все уникальные
/lib{,32,64}/rc/bin/checkpath				ix,	# части были в скрипте пакета.
/lib{,32,64}/rc/bin/ebegin				Px,
/lib{,32,64}/rc/bin/eend				Px,
/lib{,32,64}/rc/bin/eerror{,n}				Px,
/lib{,32,64}/rc/bin/einfo{,n}				Px,
/lib{,32,64}/rc/bin/eval_ecolors			Px,
/lib{,32,64}/rc/bin/ewarn{,n}				Px,
/lib{,32,64}/rc/bin/ewend				Px,
/lib{,32,64}/rc/bin/fstabinfo				Px,
/lib{,32,64}/rc/bin/mountinfo				Px,
/lib{,32,64}/rc/bin/service_crashed			Px,
/lib{,32,64}/rc/bin/service_get_value			Px,
/lib{,32,64}/rc/bin/service_hotplugged			Px,
/lib{,32,64}/rc/bin/service_inactive			Px,
/lib{,32,64}/rc/bin/service_set_value			Px,
/lib{,32,64}/rc/bin/service_started			Px,
/lib{,32,64}/rc/bin/service_started_daemon		Px,
/lib{,32,64}/rc/bin/service_starting			Px,
/lib{,32,64}/rc/bin/service_stopped			Px,
/lib{,32,64}/rc/bin/service_stopping			Px,
/lib{,32,64}/rc/bin/service_wasinactive			Px,
/lib{,32,64}/rc/bin/shell_var				Px,

# READS/WRITES -----------------------------------------
/etc/rc.conf						r,
/etc/profile.env					r,
/etc/{conf,init}.d/					r,
/run/openrc/**						rw,
/run/openrc/{,**/}*					k,
