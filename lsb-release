# ------------------------------------------------------------------
#
#  Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of version 2 of the GNU General Public
#  License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables.d/>

profile lsb-release /usr/bin/lsb_release flags=(attach_disconnected) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/lsb_release					r,
  @{shell}						mr,
  /bin/sed						Cx,
  /bin/head						Cx,
  /bin/tr						Px,
  /usr/bin/find						Cx,
  /usr/bin/getopt					Px,
  
  # READS/WRITES ---------------------------------------
  /etc/lsb-release					r,
  
  # DENY INHERIT ---------------------------------------
  deny unix (send, receive) peer=(label="discord-bin.Discord"),	# discord-bin.Discord
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  deny /etc/apparmor.d/					r,	# apparmor
  deny /opt/discord/share/discord/{,**}			r,	# discord-bin.Discord
  deny /usr/share/inkscape/extensions/			r,	# inkscape
  deny /opt/teamspeak3-client/				r,	# teamspeak-client-bin.teamspeak
  deny /run/user/[0-9]*/poedit.*			rw,	# poedit
  
  profile sed /bin/sed flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/sed						mr,
    
    # DENY INHERIT -------------------------------------
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
  }
  
  profile head /bin/head flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/head						mr,
    
    # READS/WRITES -------------------------------------
    /etc/{gentoo,os}-release				r,
    
    # DENY INHERIT -------------------------------------
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
  }
  
  profile find /usr/bin/find flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /usr/bin/find					mr,
    
    # READS/WRITES -------------------------------------
    /							r,
    /etc/						r,
    
    # NOISY --------------------------------------------
    deny /usr/bin/					r,	# Вызов chromium из smplayer.
    deny @{HOMEDIRS}**					r,	# poedit
    
    # DENY INHERIT -------------------------------------
    deny unix (send, receive) peer=(label="discord-bin.Discord"),	# discord-bin.Discord
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
    deny /etc/apparmor.d/				r,	# apparmor
    deny /opt/discord/share/discord/{,**}		r,	# discord-bin.Discord
    deny /usr/share/inkscape/extensions/		r,	# inkscape
    deny /opt/teamspeak3-client/			r,	# teamspeak-client-bin.teamspeak
    deny /run/user/[0-9]*/poedit.*			rw,	# poedit
  }
}
