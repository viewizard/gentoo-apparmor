# ------------------------------------------------------------------
#
#  Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of version 2 of the GNU General Public
#  License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <local/tunables.d/>

profile lsb-release /usr/bin/lsb_release flags=(attach_disconnected) {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/lsb_release					r,
  @{shell}						mr,
  /bin/sed						Cx,	# sys-apps/sed
  /bin/head						Cx,	# sys-apps/coreutils
  /bin/tr						Px,	# sys-apps/coreutils
  /usr/bin/find						Cx,	# sys-apps/findutils
  /usr/bin/getopt					Px,	# sys-apps/util-linux
  
  # READS/WRITES ---------------------------------------
  /etc/lsb-release					r,	# sys-apps/lsb-release
  
  # DENY INHERIT ---------------------------------------
  deny unix (send, receive) peer=(label="discord-bin.Discord"),	# net-im/discord-bin, discord-bin.Discord
  deny /apparmor/.null					rw,	# flags=(attach_disconnected)
  deny /etc/apparmor.d/					r,	# sys-apps/apparmor, apparmor
  deny /opt/discord/share/discord/{,**}			r,	# net-im/discord-bin, discord-bin.Discord
  deny /usr/share/inkscape/extensions/			r,	# media-gfx/inkscape, inkscape
  deny /opt/teamspeak3-client/				r,	# media-sound/teamspeak-client-bin, teamspeak-client-bin.teamspeak
  deny /run/user/[0-9]*/poedit.*			rw,	# app-i18n/poedit, poedit
  
  profile sed /bin/sed flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/sed						mr,
    
    # DENY INHERIT -------------------------------------
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
  }
  
  profile head /bin/head flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/head						mr,
    
    # READS/WRITES -------------------------------------
    /etc/{gentoo,os}-release				r,	# sys-apps/baselayout
    
    # DENY INHERIT -------------------------------------
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
  }
  
  profile find /usr/bin/find flags=(attach_disconnected) {
    #include <abstractions/base>
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /usr/bin/find					mr,
    
    # READS/WRITES -------------------------------------
    /							r,
    /etc/						r,
    
    # NOISY --------------------------------------------
    deny /usr/bin/					r,	# Вызов chromium из smplayer.
    deny @{HOMEDIRS}**					r,	# app-i18n/poedit, poedit
    
    # DENY INHERIT -------------------------------------
    deny unix (send, receive) peer=(label="discord-bin.Discord"),	# net-im/discord-bin, discord-bin.Discord
    deny /apparmor/.null				rw,	# flags=(attach_disconnected)
    deny /etc/apparmor.d/				r,	# sys-apps/apparmor, apparmor
    deny /opt/discord/share/discord/{,**}		r,	# net-im/discord-bin, discord-bin.Discord
    deny /usr/share/inkscape/extensions/		r,	# media-gfx/inkscape, inkscape
    deny /opt/teamspeak3-client/			r,	# media-sound/teamspeak-client-bin, teamspeak-client-bin.teamspeak
    deny /run/user/[0-9]*/poedit.*			rw,	# app-i18n/poedit, poedit
  }
}
