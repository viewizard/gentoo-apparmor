# ------------------------------------------------------------------
#
#    Copyright (C) 2016 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>

# config for abstractions/program-work-with-disk-** (**-rk,rwk)
@{PROG_DIR}="[^.]**"
@{PROG_FILE}="[^.]*"
@{PROG_FOLDERS}="{@{HOME},/mnt/,/media/,@{HOME}/.gvfs/,/etc/X11/}"

profile nvidia-settings /opt/bin/nvidia-settings flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/freedesktop.org>
  #include <abstractions/fonts>
  #include <abstractions/gtk>
  #include <abstractions/nvidia>
  #include <abstractions/X>
  #include <abstractions/user-tmp>
  #include <abstractions/program-work-with-disk-rwk>
  #include <abstractions/nameservice>


  /opt/bin/nvidia-settings r,
  /bin/bash cx,
  
  /usr/share/nvidia/ r,
  /usr/share/nvidia/** r,
  
  /etc/conf.d/gpm r,
  owner /tmp/.* m,
  
  owner @{HOME}/.nvidia-settings-rc rw,
  
  # Noisy
  deny @{HOMEDIRS}/* w,
  @{HOMEDIRS}/*/ w,
  
  
  profile bash /bin/bash flags=(complain) {
    #include <abstractions/base>
    
    capability sys_ptrace,
    
    /dev/tty rw,
    @{PROC} r,
    owner @{PROC}/cmdline r,
    @{PROC}/uptime r,
    @{PROC}/sys/kernel/pid_max r,
    @{PROC}/@{pid}/stat r,
    @{PROC}/@{pid}/status r,
  
    /bin/bash r,
    /bin/ps ix,
    /usr/bin/Xorg ix,
    /usr/bin/pkg-config ix,
    
    /usr/share/pkgconfig/ r,
    
  }

}


profile nvidia-modprobe /opt/bin/nvidia-modprobe flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nvidia>

}


profile nvidia-smi /opt/bin/nvidia-smi flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nvidia>

  capability sys_admin,

  /dev/nvidiactl rw,
  /dev/nvidia0 rw,
  @{PROC}/driver/nvidia/params r,

}
