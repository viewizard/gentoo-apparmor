# ------------------------------------------------------------------
#
#  Copyright (C) 2017 Mikhail Kurinnoi
#
#  This program is free software; you can redistribute it and/or
#  modify it under the terms of version 2 of the GNU General Public
#  License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <local/tunables.d/>

profile kbd.fgconsole /usr/bin/fgconsole {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  
  # PSEUDO ---------------------------------------------
  /dev/tty						rw,
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/fgconsole					mr,
}

profile kbd.deallocvt /usr/bin/deallocvt {
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/deallocvt					mr,
}

profile kbd.chvt /usr/bin/chvt {				# Корректировать с xorg-server.xdm.init.d.
  #include <abstractions/base>
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/chvt						mr,
}

profile kbd.kbd_mode /usr/bin/kbd_mode {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/kbd_mode					mr,
}

profile kbd.loadkeys /usr/bin/loadkeys {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/loadkeys					mr,
  @{shell}						Cx,
  
  # READS/WRITES ---------------------------------------
  /							r,
  /usr/share/keymaps/{,**}				r,
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
    
    # CAPABILITIES -------------------------------------
    capability sys_tty_config,
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/gzip						ix,	# app-arch/gzip		# Оставляем вызов через ix.
    
    # READS/WRITES -------------------------------------
    /usr/share/keymaps/{,**/,**.gz}			r,
  }
}

profile kbd.dumpkeys /usr/bin/dumpkeys {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/dumpkeys					mr,
  
  # READS/WRITES ---------------------------------------
  /lib{,32,64}/rc/console/keymap			w,	# sys-apps/openrc
}

profile kbd.setfont /usr/bin/setfont {
  #include <abstractions/base>
  
  # CAPABILITIES ---------------------------------------
  capability sys_tty_config,
  
  # PSEUDO ---------------------------------------------
  /dev/tty[0-9]*					rw,
  /dev/console						rw,
  /dev/pts/[0-9]*					rw,
  
  # EXECUTABLES ----------------------------------------
  /usr/bin/setfont					mr,
  @{shell}						Cx,
  
  # READS/WRITES ---------------------------------------
  /							r,
  /usr/share/consolefonts/{,**}				r,
  /lib{,32,64}/rc/console/font				rw,	# sys-apps/openrc
  
  profile shell @{shell} {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc-shell>
    
    # CAPABILITIES -------------------------------------
    capability sys_tty_config,
    
    # PSEUDO -------------------------------------------
    /dev/tty[0-9]*					rw,
    /dev/console					rw,
    /dev/pts/[0-9]*					rw,
    
    # EXECUTABLES --------------------------------------
    /bin/gzip						ix,	# app-arch/gzip		# Оставляем вызов через ix.
    
    # READS/WRITES -------------------------------------
    /usr/share/consolefonts/{,**/,**.gz}		r,
  }
}
