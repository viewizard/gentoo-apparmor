# ------------------------------------------------------------------
#
#    Copyright (C) 2016,2017 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>
profile acpid /usr/sbin/acpid {
  #include <abstractions/base>
  
  capability sys_tty_config,
  
  /dev/console w,
  /dev/input/ r,
  /dev/input/by-id/ r,
  /dev/input/by-path/ r,
  /dev/input/event* r,
  /dev/input/mouse* r,
  owner @{PROC}/@{pid}/fd/ r,
  
  /usr/sbin/acpid mr,
  /bin/bash Cx -> shell,
  
  /etc/acpi/{,**} r,
  /run/acpid.pid rwl,
  /run/acpid.socket rw,
  
  
  profile shell flags=(complain) {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    
    capability sys_tty_config,
    
    /dev/tty{,[0-9]*} rw,
    
    /bin/bash mr,
    /bin/ps Px,
    /bin/sed ix,
    /sbin/shutdown Px,
    /usr/bin/fgconsole ix,
    /usr/bin/gawk ix,
    /usr/bin/logger Px,
    /usr/bin/pinky ix,
    /usr/bin/pgrep Px,
    /usr/bin/pidof Px,
    /etc/acpi/default.sh ixr,
    /etc/acpi/actions/powerbtn.sh ixr,
    
    /run/utmp rk,
    
  }
  
}

profile acpid.acpi_listen /usr/bin/acpi_listen flags=(complain) {
  #include <abstractions/base>
  
  /usr/bin/acpi_listen mr,
  
}

profile acpid.kacpimon /usr/sbin/kacpimon {
  #include <abstractions/base>
  
  /dev/pts/[0-9]* rw,
  /dev/input/{,event*} r,
  
  /usr/sbin/kacpimon mr,
  
}


profile acpid.init.d /etc/init.d/acpid {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  /usr/sbin/acpid Px,
  /bin/bash Cx -> shell,
  
  /etc/{conf,init}.d/acpid r,
  
  
  profile shell {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    #include <abstractions/openrc_shell>
    
  }
  
}
