# ------------------------------------------------------------------
#
#    Copyright (C) 2016 Mikhail Kurinnoi
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#
# ------------------------------------------------------------------

#include <tunables/global>
profile acpid /usr/sbin/acpid flags=(complain) {
  #include <abstractions/base>

  owner @{PROC}/@{pid}/fd/ r,

  /dev/input/ r,
  /dev/input/by-id/ r,
  /dev/input/by-path/ r,
  /dev/input/event* r,
  /dev/input/mouse* r,
  
  /usr/sbin/acpid r,
  /bin/bash Cxr -> shell,
  
  /etc/acpi/ r,
  /etc/acpi/** r,
  
  /run/acpid.pid rwl,
  /run/acpid.socket rw,
  
  
  profile shell flags=(complain) {
    #include <abstractions/base>
    #include <abstractions/nameservice>
    
    capability sys_tty_config,
    capability sys_ptrace,
    
    /dev/tty rw,
    /dev/tty[0-9]* rw,
    
    @{PROC}/ r,
    @{PROC}/@{pid}/loginuid r,
    @{PROC}/@{pid}/stat r,
    @{PROC}/@{pid}/status r,
    @{PROC}/@{pid}/cmdline r,
    owner @{PROC}/uptime r,
    owner @{PROC}/sys/kernel/pid_max r,
    @{PROC}/tty/drivers r,
    
    /bin/bash r,
    /usr/bin/logger ix,
    /usr/bin/pinky ix,
    /usr/bin/pgrep ix,
    /bin/ps ix,
    /usr/bin/gawk ix,
    /bin/sed ix,
    /usr/bin/fgconsole ix,
    /bin/pidof ix,
    /sbin/shutdown Px,
    
    /etc/acpi/default.sh ixr,
    /etc/acpi/actions/powerbtn.sh ixr,
    
    /run/utmp rk,
    
  }
  
}

profile acpid.acpi_listen /usr/bin/acpi_listen flags=(complain) {
  #include <abstractions/base>
  
}

profile acpid.kacpimon /usr/sbin/kacpimon flags=(complain) {
  #include <abstractions/base>
  
  /dev/pts/[0-9]* rw,
  /dev/input/ r,
  /dev/input/event* r,
  
}


profile acpid.init.d /etc/init.d/acpid flags=(complain) {
  #include <abstractions/base>
  #include <abstractions/nameservice>
  #include <abstractions/openrc>
  
  /usr/sbin/acpid Px,
  
  /etc/init.d/acpid r,
  /etc/conf.d/acpid r,
  
}
